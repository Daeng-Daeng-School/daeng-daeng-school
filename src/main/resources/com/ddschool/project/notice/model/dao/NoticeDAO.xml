<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.ddschool.project.notice.model.dao.NoticeDAO">

	<!-- 알림장 DTO에 대한 일반적인 결과 매핑(전체 컬럼) -->
	<resultMap
		type="com.ddschool.project.notice.model.dto.NoticeDTO"
		id="generalNoticeResultMap">
		<id property="noticeNo" column="BOARD_CODE" /> <!-- Primary Key: 알림장 번호 -->
		<result property="dogNo" column="DOG_CODE" /> <!-- 반려견 번호 -->
		<result property="noticeWriter" column="MEMBER_CODE" /> <!-- 작성자 번호 -->
		<result property="noticeTitle" column="TITLE" /> <!-- 알림장 제목 -->
		<result property="noticeBody" column="CONTENT" /> <!-- 알림장 내용 -->
		<result property="createdDate" column="REGIST_DATE" /> <!-- 등록일 -->
		<result property="modifiedDate" column="MODIFY_DATE" /> <!-- 수정일 -->
		<result property="noticeStatus" column="STATUS" /> <!-- 알림장 상태 -->
	</resultMap>

	<!-- 알림장 등록 쿼리 -->
	<insert id="insertNotice">
		INSERT INTO TBL_NOTICE (REGIST_DATE, DOG_CODE,
		CONTENT, TITLE, MEMBER_CODE,
		STATUS)
		VALUES (#{createdDate}, #{dogNo},
		#{noticeBody}, #{noticeTitle},
		#{noticeWriter}, 1)
	</insert>

	<!-- 검색 조건에 따른 전체 알림장 수 조회 쿼리 -->
	<select id="selectTotalCount" resultType="int"
		parameterType="java.util.Map">
		SELECT COUNT(*)
		FROM TBL_NOTICE
		WHERE STATUS = 1
		<!-- 활성화된 알림장만 조회 -->
	</select>


	<!-- 페이징 처리가 적용된 알림장 목록 조회 쿼리 (SQL Server) -->
	<select id="selectNotice" resultMap="generalNoticeResultMap"
		parameterType="java.util.Map">
		SELECT BOARD_CODE, MEMBER_CODE, REGIST_DATE, TITLE,
		CONTENT
		FROM TBL_NOTICE
		WHERE STATUS = 1
		ORDER BY BOARD_CODE DESC
		LIMIT
		#{offset}, #{limit}
	</select>


	<!-- 검색 조건에 따른 알림장 조회 쿼리 -->
	<select id="searchNotices" parameterType="java.util.Map"
		resultMap="generalNoticeResultMap">
		SELECT
		BOARD_CODE,
		MEMBER_CODE,
		REGIST_DATE,
		TITLE,
		CONTENT
		FROM
		TBL_NOTICE
		WHERE
		STATUS = 1
		AND (
		TITLE LIKE CONCAT('%', #{keyword}, '%')
		OR MEMBER_CODE LIKE CONCAT('%', #{keyword}, '%')
		OR CONTENT LIKE
		CONCAT('%', #{keyword}, '%')
		OR REGIST_DATE LIKE CONCAT('%',
		#{keyword}, '%')
		)
		ORDER BY
		BOARD_CODE DESC
	</select>

	<!-- 알림장 상세내용 조회 쿼리 -->
	<select id="selectNoticeDetail" parameterType="int"
		resultMap="generalNoticeResultMap">
		SELECT BOARD_CODE, MEMBER_CODE, REGIST_DATE, TITLE, CONTENT
		FROM TBL_NOTICE
		WHERE BOARD_CODE = #{noticeNo}
	</select>

	<!-- 알림장 내용 수정 쿼리 -->
	<update id="updateNotice"
		parameterType="com.ddschool.project.notice.model.dto.NoticeDTO">
		UPDATE TBL_NOTICE
		SET TITLE = #{noticeTitle}, CONTENT =
		#{noticeBody}, MODIFY_DATE =
		current_date
		WHERE BOARD_CODE = #{noticeNo}
	</update>

	<!-- 알림장 삭제 쿼리 -->
	<update id="deleteNotice" parameterType="int">
		UPDATE TBL_NOTICE
		SET
		STATUS = 0, MODIFY_DATE = current_date
		WHERE BOARD_CODE = #{noticeNo}
	</update>

</mapper>
